<html>
    <head>
        <!-- Bootstrap -->
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="https://cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script>
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <script type="text/javascript">
            $(document).ready(function(){
             
             var callAPI = function () {
            
                //get the searchString
                var searchString = $('#term').val();
            
                // if it is blank let them know
                if(searchString === ""){
                    $('#results').html("<h2>Please enter a search term.</h2>");
                }
                else{
                    $.getJSON( "http://catalogue.data.gov.bc.ca/api/action/datastore_search?resource_id=ad1388e5-e315-4b61-8232-1ef3fefb8408&limit=500&q="+searchString, function( data ) {
                      console.log(data.result.records[1]);
                      console.log(data.result.records[1].PRODUCT_LONG_NAME);
                        // create a blank array
                        var items = [];
            
                        // go through the records from the response and push them into the array as an HTML list
                        $.each( data.result.records, function( key, val ) {
                            items.push( "<li id='" + key + "'>" + val.PRODUCT_LONG_NAME + " $" + val.CURRENT_DISPLAY_PRICE + "</li>" );
                          });
                      /* write the array to the results div
                      /* $('#results').html(items);
            
                      /* write the table now*/
                        $('#example').dataTable( {
                       data:data.result.records,
                       columns:[
                       {data: 'PRODUCT_CLASS_NAME'},
                       {data: 'PRODUCT_LONG_NAME'},
                       {data: 'CURRENT_DISPLAY_PRICE'}
            
            
                       ]
                        } );
            
            /* ********************************************** */
                      });
                };
            
               }
            
            
            //if someone presses search
              $('#search').click(callAPI);
            
            //if someone presses enter
              $('#term').keyup(function(event){
                   if(event.keyCode == 13){
                       callAPI();
                   }
               });
            
            
              });
        </script>
    </head>
    <body>
        
        <ul class="nav nav-tabs">
          <li role="presentation" class="active"><a href="#">DataTables</a></li>
          <li role="presentation"><a href="#">GoogleMaps</a></li>
          <li role="presentation"><a href="#">Graphs</a></li>
        </ul>
        
        <div class="container">
            <header>
                 <h1>Find a Beverage</h1>

            </header>
            <section id="fetch">
                <input type="text" placeholder="enter a search" id="term" />
                <button id="search">Search the datastore</button>
                <HR>
            </section>
            <section id="results"></section>
            <div class="col-md-6">
                <table class="table table-striped" id="example">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Name</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>PRODUCT_CLASS_NAME</th>
                            <th>PRODUCT_LONG_NAME</th>
                            <th>CURRENT_DISPLAY_PRICE</th>
                        </tr>
                    </tfoot>
                    </tbody>
                </table>
            </div>
            <footer>
                <p><a href=http://catalogue.data.gov.bc.ca/dataset/bc-liquor-store-product-price-list-current-prices/>Dataset Used</a>
                </p>
            </footer>
        </div>
    </body>
</html>